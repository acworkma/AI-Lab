{
  "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "description": "Example parameter file demonstrating Key Vault reference pattern for secure parameter management. Use this template for production deployments where sensitive values must not be hardcoded."
  },
  "parameters": {
    "location": {
      "value": "eastus2"
    },
    "environment": {
      "value": "prod"
    },
    "owner": {
      "value": "AI-Lab Team"
    },
    "resourceGroupName": {
      "value": "rg-ai-core"
    },
    "vwanName": {
      "value": "vwan-ai-hub"
    },
    "vhubName": {
      "value": "hub-ai-eastus2"
    },
    "vhubAddressPrefix": {
      "value": "10.0.0.0/16"
    },
    "vpnGatewayName": {
      "value": "vpngw-ai-hub"
    },
    "vpnGatewayScaleUnit": {
      "value": 1
    },
    "enableBgp": {
      "value": true
    },
    "bgpAsn": {
      "value": 65515
    },
    "keyVaultName": {
      "reference": {
        "keyVault": {
          "id": "/subscriptions/<SUBSCRIPTION_ID>/resourceGroups/rg-ai-secrets/providers/Microsoft.KeyVault/vaults/<SECRETS_VAULT_NAME>"
        },
        "secretName": "core-keyvault-name"
      },
      "metadata": {
        "description": "Example: Store Key Vault name as secret in a separate secrets management vault"
      }
    },
    "keyVaultSku": {
      "value": "standard"
    },
    "enablePurgeProtection": {
      "value": true,
      "metadata": {
        "description": "Production environments should enable purge protection"
      }
    },
    "deployedBy": {
      "value": "automation"
    },
    "tags": {
      "value": {
        "costCenter": "Engineering",
        "project": "AI-Lab",
        "environment": "production"
      }
    }
  },
  "examples": {
    "_comment": "Below are examples of common Key Vault reference patterns (not valid parameters, for documentation only)",
    "vpnSharedKey": {
      "reference": {
        "keyVault": {
          "id": "/subscriptions/<SUBSCRIPTION_ID>/resourceGroups/rg-ai-core/providers/Microsoft.KeyVault/vaults/kv-ai-core-prod"
        },
        "secretName": "vpn-shared-key"
      },
      "description": "VPN shared key for site-to-site connections (store in Key Vault after initial deployment)"
    },
    "adminPassword": {
      "reference": {
        "keyVault": {
          "id": "/subscriptions/<SUBSCRIPTION_ID>/resourceGroups/rg-ai-core/providers/Microsoft.KeyVault/vaults/kv-ai-core-prod"
        },
        "secretName": "vm-admin-password"
      },
      "description": "VM administrator password for spoke lab resources"
    },
    "connectionString": {
      "reference": {
        "keyVault": {
          "id": "/subscriptions/<SUBSCRIPTION_ID>/resourceGroups/rg-ai-core/providers/Microsoft.KeyVault/vaults/kv-ai-core-prod"
        },
        "secretName": "database-connection-string"
      },
      "description": "Database connection string for lab applications"
    }
  },
  "instructions": {
    "_comment": "How to use this file:",
    "step1": "Create secrets in Key Vault BEFORE deployment",
    "step2": "Replace placeholder values (<SUBSCRIPTION_ID>, <SECRETS_VAULT_NAME>) with actual values",
    "step3": "Ensure deploying user/service principal has 'Key Vault Secrets User' role on referenced vault",
    "step4": "Deploy using: az deployment sub create --parameters @bicep/main.keyvault-ref.parameters.json",
    "step5": "NEVER commit files with actual subscription IDs or secret names to source control - use .local.parameters.json pattern (gitignored)"
  },
  "workflow": {
    "_comment": "Production deployment workflow with secrets:",
    "1_store_secret": "az keyvault secret set --vault-name kv-ai-core-prod --name vpn-shared-key --value '<strong-random-key>'",
    "2_create_local_params": "cp bicep/main.keyvault-ref.parameters.json bicep/main.local.parameters.json",
    "3_edit_local_params": "nano bicep/main.local.parameters.json  # Add actual subscription ID and vault names",
    "4_deploy": "./scripts/deploy-core.sh --parameter-file bicep/main.local.parameters.json",
    "5_verify_gitignore": "git status  # Should NOT show .local.parameters.json files"
  }
}
